{% extends "base.html" %}
{% load staticfiles %}

{# Load the tag library #}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{% block head_title %}
main
{% endblock head_title %}

{% block content %}

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>



    <div class="main-wrapper" style="margin-top: 80px">
        <header class="main-header">
        {% if not user.is_authenticated %}
        <form action="{% url 'accounts:login' %}" method="post">
          {% csrf_token %}
          {{ login_form }}
          <input type="submit" name="">
        </form>
        {% else %}
        <a href="{% url 'accounts:logout' %}">로그아웃</a>
        {% endif %}
        </header>
        <div class="content-wrapper">

        <button id="write_posting_btn">글 남기기</button>
        <div class="col-sm-6 col-sm-offset-3" >
            <div id="write_posting">

                <form action="{% url 'blog:post_create' %}" method="post">
                {% csrf_token %}
                    <input name="content" value="{{ content }}" placeholder="내용">
                    <input name="tag_set" value="{{ tag_set }}" placeholder="태그">
                    <input type="submit" value="OK" class="btn btn-primary">
                </form>
                </div>
            </div>
    <div class="main-wrapper">
        <header class="main-header">
        </header>
        <div class="content-wrapper">
        {% for post in posts %}
        <div class="content">
                <h2>{{ post.content }}</h2><p> {{ post.created_at }}  by {{ post.author }}</p>
                <p>태그:{{ post.tag_set }}</p>
                <ul>
                    <form action="{% url 'blog:comment_create' post.id %}" method="post">
                    {% csrf_token %}
                        <input name="content" value="{{ content }}">
                        <input type="submit" value="댓글 달기" class="btn btn-primary">
                    </form>
                    {% for comment in post.comment_set.all %}
                    <li>
                        {{comment.content}} by {{comment.author}}
                        <a href="{% url 'blog:comment_update' post.id comment.id %}">수정</a>
                        <a href="{% url 'blog:comment_delete' post.id comment.id %}">삭제</a>
                    </li>
                    {% endfor %}
                </ul>
        </div>
        </a>
        {% endfor %}
        </div>
        <footer></footer>
    </div>

    <script>
    $("#write_posting_btn").click(function(){
        $("#write_posting").slideToggle(1000);

    })
    </script>
    <script type="text/javascript">
        $(document).ready(function() {
     $("tag_set").bind("keyup", function () {

      /* replaces text as you type with hashtags */

      var input = $(this);
      var value = input.val();
      var ends_with_space = (value.substr(-1) == " ");

      var hashed_value = "";
      var parts = value.split(" ");
      for (var i = 0; i < parts.length; i++) {
       var part = parts[i];
       if (part.indexOf("#") != 0) {
        part = "#" + part;
       }
       if (part != "#") {
        if (hashed_value == "") {
         hashed_value = part;
        } else {
         hashed_value += " " + part;
        }
       }
      }
      if (ends_with_space) {
       hashed_value = hashed_value + " ";
      }
      input.val(hashed_value.replace(",", ""));
     });

    });

    </script>
    {% endblock content %}
